This code was primarily written by Benjamin Beurdouche (INRIA)